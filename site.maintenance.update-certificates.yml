# Warning! Each maintenance playbook shall run without generated vars being present!
# It should fetch this information as needed, without the need to run whole infra step.
- import_playbook: site.common.group-current-hosts.yml

- hosts: varnish:&current:!immutable
  become: yes
  roles:
    - role: cs.aws-node-facts
      delegate_to: localhost
      become: no
      when: aws_use
    - role: cs.nginx-url-blacklist
    - role: cs.nginx-https-termination
      varnish_port: "{{ mageops_varnish_port }}"
      when: mageops_https_termination_enable
  vars:
    mageops_node_role: varnish
