- hosts: localhost
  connection: local
  gather_facts: false
  pre_tasks:
    - name: Collect minimum facts (we need date time stuff)
      setup:
        gather_subset: min
  roles:
    - role: cs.aws-vpc
    - role: cs.aws-security-group
    - role: cs.aws-ami-facts
      ami_facts_instance: "{{ aws_shopware_node_instance_type }}"
    - role: cs.aws-node-facts
    - role: cs.aws-node-shopware
      aws_shopware_node_root_device: "{{ aws_ami_clean_base_info[aws_shopware_node_instance_type].root_device_name }}"
      aws_shopware_node_vpc_subnet_id: "{{ aws_vpc_subnet_id }}"
      aws_shopware_instance_id: "{{ aws_shopware_node_instance.instance_id | default(false) }}"
  tasks:
    - name: Refresh inventory to get info about newly created nodes
      meta: refresh_inventory
