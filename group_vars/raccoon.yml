aws_use: no

mageops_node_role: raccoon
mageops_app_host_group: raccoon
mageops_secure_site: no

# Whether the ansible code is being run live on developer's machine
# or a base, distributable container/vm is being provisioned
raccoon_live_mode: yes

# If true then the full production-mode configuration will be performed
# with SCD and other production-mode specific tasks and failsafes.
raccoon_project_production_mode: no

# Whether the provisioning is being ran inside the virtualized (or containerized)
# environment with local connection or executed remotely via SSH/docker exec
raccoon_nested_provisioning: no

# The type of virtualization/containerization solution used to run raccoon
raccoon_virt: >-
  {{
      ansible_connection | default('local') == 'docker' or (
          ansible_virtualization_role | default('host') == 'guest'
          and  ansible_virtualization_type | default('NA') in ['docker', 'podman']
      ) | ternary('docker', 'virtualbox')
  }}
# Install tools helpful during development
mageops_install_development_tools: yes

# Override the default release dir
magento_release_dir: "{{ raccoon_project_dir }}"

# Disable redirect to base
magento_core_config_enable_redirect_to_base: 0

# Https as an option but not the default, port 80 can be used normally
mageops_https_enable: no
mageops_https_termination_enable: yes
https_termination_hide_varnish: no

mageops_packages_full_update: yes
mageops_packages_app_node_extra:
  - ghostscript

php_opcache_validate_timestamps: 1
php_opcache_consistency_checks: 1
php_opcache_file_update_protection: 2


php_opcache_revalidate_path: 1
php_opcache_revalidate_freq: 0

php_cli_opcache_file_cache_enable: yes
php_cli_opcache_file_cache_consistency_checks: 1

php_display_errors: On
php_http_request_max_execution_time: 600

# services to stop during PHP reinstallation
php_reinstall_dependent_services:
    - crond
    - php-fpm
    - supervisord
    - varnish
    - nginx

elasticsearch_create: yes
elasticsearch_heap_size: 512m

varnish_standalone: false
varnish_memory: 128M

redis_create: yes
redis_maxmemory: 150M

mageops_mysql_create: yes
mageops_app_umask: '0002'

mysql_public_root_access: yes
mysql_mariadb_flavor: yes

nginx_app_port: 80

mageops_varnish_host: 127.0.0.1
mageops_varnish_port: 8080
mageops_varnish_backend_port: "{{ nginx_app_port }}"
mageops_mysql_host: 127.0.0.1
mageops_elasticsearch_host: 127.0.0.1
mageops_redis_host: 127.0.0.1
mageops_redis_sessions_host: 127.0.0.1
mageops_rabbitmq_host: 127.0.0.1

magento_mode: "{{ raccoon_project_production_mode | ternary('production', 'default') }}"
magento_configure_for_production: "{{ raccoon_project_production_mode }}"
magento_redis_cache: yes
magento_cron_disabled: yes
magento_nginx_rewrite_static_assets_version: yes
mageops_root_ssh_keys_global: []

sshd_password_auth: yes
sshd_max_auth_tries: 20
sshd_permit_root_login: yes
sshd_lockdown_untrusted_networks: no
sshd_trusted_networks: "{{ ['127.0.0.0/8'] + mageops_trusted_cidr_blocks }}"

mageops_authorize_local_keys: "{{ not raccoon_nested_provisioning }}"
mageops_cli_user_groups: [wheel]
mageops_cli_user_authorize_local_key: "{{ mageops_authorize_local_keys }}"

mageops_packages_mirrorlist_countrycode: de
mageops_packages_raccoon_node:
  # Basic build tools are needed for nodejs packages installation, e.g.
  # the `gifsicle` package cannot be installed without them and theme
  # build will fail.
  - gcc
  - gcc-c++
  - make
  - autoconf
  - automake
  # Needed for patching Magento and all else
  - patch
