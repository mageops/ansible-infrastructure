- name: Get info about security groups
  amazon.aws.ec2_group_info:
    region: "{{ aws_region }}"
    filters: "{{ aws_sg_facts_filters | combine (aws_sg_facts_tags | prefix_keys('tag:')) }}"
  register: ec2_group_facts

- name: Set info about security groups
  set_fact:
    aws_security_groups_info: "{{ ec2_group_facts.security_groups }}"
    cacheable: yes

- name: Set info for each security group
  set_fact:
  aws_security_group_shopware: "{{ aws_security_groups_info | selectattr('group_name', 'equalto', aws_security_group_shopware_name) | list | default([false], true) | first }}"
  cacheable: yes

- name: Set id fact for each security group
  set_fact:
      aws_security_group_persistant_id: "{{ aws_security_group_shopware.group_id | default(omit) }}"
  cacheable: yes
