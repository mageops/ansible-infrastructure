- name: Install vmtouch for preloading fs cache
  yum:
    name: vmtouch
    state: latest

- name: Install magento source fs cache preloader systemd unit files
  template:
    src: "{{ unit }}"
    dest: "/etc/systemd/system/{{ unit }}"
  loop_control:
    loop_var: unit
  loop:
    - magento-preload-sources.service
    - magento-preload-sources-watcher.service
    - magento-preload-sources-watcher.timer
    - magento-preload-sources-watcher.path

- name: Enable and restart magento source fs cache preloader systemd units
  systemd:
    name: "{{ unit }}"
    state: restarted
    enabled: yes
    daemon_reexec: yes
    daemon_reload: yes
  loop_control:
    loop_var: unit
  loop:
    - magento-preload-sources.service
    - magento-preload-sources-watcher.service
    - magento-preload-sources-watcher.timer
    - magento-preload-sources-watcher.path
    