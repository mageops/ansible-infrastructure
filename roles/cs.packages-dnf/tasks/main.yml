- name: Switch package manager backend to dnf
  when: pkg_mgr | default('yum') != 'dnf'
  block:
    - name: Clean package manager cache
      command:
        cmd: "{{ item }}"
        warn: no
      changed_when: no
      loop:
        - yum clean all       # Clean all yum caches because it won't be used at all from now on
        - dnf clean packages  # Clean only downloaded package cache

    - name: Remove fastest mirror cache
      file:
        path: /var/cache/dnf/fastestmirror.cache
        state: absent

    - name: Update metadata cache
      command:
        cmd: dnf makecache
        warn: no

- name: Switch ansible package manager to dnf
  set_fact:
    ansible_facts:
      pkg_mgr: dnf

# systemctl enable --now dnf-makecache.timer
