- name: Refresh metadata for early speedup
  include_role:
    name: cs.package-manager
    tasks_from: _refresh.yml

- name: Perform periodic maintenance
  import_tasks: maintenance.yml

- name: Remove banned packages
  when: packages_remove | length > 0
  dnf:
    name: "{{ packages_remove | default([]) }}"
    state: absent
    update_cache: no

- name: Install requested packages
  when: packages_install | length > 0
  dnf:
    name: "{{ packages_install }}"
    state: present
  register: packages_install_command
  retries: 5
  delay: 5
  until: not packages_install_command is failed


