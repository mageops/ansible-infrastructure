- name: Create MageOps Bash Tools Directories
  file:
    path: "{{ item }}"
    state: directory
    mode: 0755
    recurse: yes
  loop:
    - "{{ mageops_cli_bash_tools_dir }}"

- name: "Install MageOps Bash Tools (from tarball {{ mageops_cli_bash_tools_url }})"
  when: mageops_cli_bash_tools_local_src_dir is not exists
  unarchive:
    src: "{{ mageops_cli_bash_tools_release_url }}"
    dest: "{{ mageops_cli_bash_tools_dir }}"
    creates: "{{ mageops_cli_bash_lib_entrypoint }}"
    extra_opts: [ "--strip-components=1" ]
    remote_src: yes

- name: "Install MageOps Bash Tools (from local sources {{ mageops_cli_bash_tools_local_src_dir }})"
  when: mageops_cli_bash_tools_local_src_dir is exists
  copy: 
    src: "{{ mageops_cli_bash_tools_local_src_dir }}/"
    dest: "{{ mageops_cli_bash_tools_dir }}/"
  
- name: Install MageOps Bash Tools profile.d fragments
  template:
    src: "profile.d/{{ item }}"
    dest: "/etc/profile.d/{{ item }}"
    mode: 0755
  loop:
    - 000-mageops-bash-tools.sh

